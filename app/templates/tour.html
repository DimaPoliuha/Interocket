{% extends 'wrapper.html' %}

{% block content %}
    <div class="col-lg-12 col-md-12 mb-12">
      <div class="card h-100">
        <a href="#"><img class="card-img-top" src="{{ tour.image.url }}" alt=""></a>
        <div class="card-body">
          <h4 class="card-title">
            <a href="{{ tour.get_absolute_url }}">{{ tour.title }}</a>
          </h4>
          <h5>{{ tour.price }} BTC</h5>
          <p class="card-text">{{ tour.description }}</p>
            {% if request.user.is_authenticated %}
                <a href="" class="add-to-cart" data-slug="{{ tour.slug }}"><button class="btn btn-danger">Add to cart</button></a>
            {% else %}
                <a href="" class=""><button class="btn btn-danger">Authorise to buy a tour</button></a>
            {% endif %}
        </div>
      </div>
    </div>
{% endblock content %}

{% block jquery %}
    <script>
    $( document ).ready(function() {
        $('.add-to-cart').on('click', function(e) {
            e.preventDefault();
            let tour_slug = $(this).attr('data-slug');
            let data = {
                tour_slug
            }

            $.ajax({
                type: "GET",
                url: "{% url 'add_to_cart' %}",
                data,
                success: (data) => {
                    $('#cart-count').html(data.cart_total_count)
                }
            })
        })
    });
    </script>
{% endblock %}